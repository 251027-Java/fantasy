<div style="margin: 0.5% auto 0;" class="w-full overflow-x-auto border-separate border-2 border-spacing-0 border border-white rounded-md rounded-bl-sm rounded-br-sm" [style.width.%]="getWidth()" [ngClass]="themeService.getCurrentThemeClassString('tableBodyGradientClass')">
    <table class="min-w-full table-fixed">
        <thead>
            <tr>
                <th class="whitespace-nowrap px-4 py-3 border border-gray-300 text-gray-100 text-center border-b border-r border-b-2 border-r-2 cursor-pointer" [ngClass]="[statsService.getNameColumnWidthClassString(getNumDataColumnsVisible()), themeService.getCurrentThemeClassString('headerNameClass')]" (click)="toggleSort('name')">
                    <div class="flex items-center justify-center px-1">
                        <span>Name</span>
                        @if (statsService.getStatsLoaded("MedianLuck")) {
                            <span class="ml-1 flex flex-col text-xs leading-2 select-none">
                                @for (arrow of getSortArrows('name'); track arrow) {
                                    <span>{{arrow}}</span>
                                }
                            </span>
                        }
                    </div>
                </th>
                @if (statsService.getStatsLoaded("MedianLuck")) {
                    @for (score of statsService.statsResponse().weeklyMedianLuck[0].stats; track idx; let idx = $index) {
                        @if (statsService.getColumnIsVisible("MedianLuck", idx + 1)) {
                            <th class="whitespace-nowrap py-3 border border-gray-200 text-gray-100 text-center border-b border-b-2 border-gray-300 cursor-pointer" [ngClass]="[statsService.getDataColumnWidthClassString(getNumDataColumnsVisible()), themeService.getCurrentThemeClassString('headerTableClass')]" (click)="toggleSort(idx + 1)">
                                <div class="flex items-center justify-center px-1">
                                    <span>Week {{idx + 1}}</span>
                                    <span class="ml-1 flex flex-col text-xs leading-2 select-none">
                                        @for (arrow of getSortArrows(idx + 1); track arrow) {
                                            <span>{{arrow}}</span>
                                        }
                                    </span>
                                </div>
                            </th>
                        }
                    }
                }
            </tr>
        </thead>

        @if (statsService.getStatsLoaded("MedianLuck")) {
            <tbody>
                @for (member of statsService.statsResponse().weeklyMedianLuck; track member.userName) {
                    @if (statsService.getMemberIsVisible(member.userName)) {
                        <tr>
                            <td class="whitespace-nowrap px-4 py-2 border-t border-b border-l border-gray-200 border-r border-r-2 border-r-gray-300 bg-gray-900 text-gray-100 text-center" [ngClass]="statsService.getNameColumnWidthClassString(getNumDataColumnsVisible())">{{member.userName}}</td>
                            @for (score of statsService.statsResponse().weeklyMedianLuck[0].stats; track idx; let idx = $index) {                                
                                @if (statsService.getColumnIsVisible("MedianLuck", idx + 1)) {
                                    <td class="whitespace-nowrap text-gray-100 px-1 py-2 border border-gray-200 text-center" [ngClass]="[statsService.getDataColumnWidthClassString(getNumDataColumnsVisible()), themeService.getCurrentThemeClassString('bodyTableClass')]">{{member.stats[idx]}}</td>
                                }
                            }
                        </tr>
                    }
                }
            </tbody>
        }
    </table>

    @if (!statsService.getStatsLoaded("MedianLuck")) {
        <div class="h-72 flex items-center justify-center" [ngClass]="themeService.getCurrentThemeClassString('loadingTableBackgroundClass')">
            <p class="text-4xl text-center font-semibold" [ngClass]="themeService.getCurrentThemeClassString('loadingTableClass')">Loading Scores...</p>
        </div>
    } @else if (statsService.getNumMembersVisible() === 0) {        
        <div class="h-24 flex items-center justify-center" [ngClass]="themeService.getCurrentThemeClassString('loadingTableBackgroundClass')">
            <p class="text-4xl text-center font-semibold" [ngClass]="themeService.getCurrentThemeClassString('loadingTableClass')">Nobody to show!</p>
        </div>
    }
</div>

@if (statsService.getStatsLoaded("MedianLuck")) {
    <div class="mx-auto flex justify-around mt-6 text-gray-100" style="width: 90%;">
        <div class="border border-white border-2 rounded-md p-4 w-9/20 xl:w-1/6 lg:w-1/4 md:w-3/10 sm:w-1/3 bg-gray-800">
            <h3 class="text-lg font-semibold mb-3 text-center break-all whitespace-normal">League Members</h3>
            <div class="flex flex-col space-y-1">
                @for (member of statsService.filteredLeagueMembers | keyvalue: caseInsensitiveSort; track member.key) {
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="outline outline-white form-checkbox h-5 w-5 text-blue-600" [checked]="member.value" (change)="onMemberFilterChange($event, member.key)">
                        <span class="break-all">{{member.key}}</span>
                    </label>
                }
            </div>
        </div>

        <div class="border border-white border-2 rounded-md p-4 w-9/20 lg:w-1/4 sm:w-1/3" [ngClass]="themeService.getCurrentThemeClassString('tableBodyGradientClass')">
            <h3 class="text-lg font-semibold mb-3 text-center">Weeks</h3>
            <div class="columns-2 gap-4 space-y-1">
                @for (score of statsService.statsResponse().weeklyMedianLuck[0].stats; track idx; let idx = $index) {
                    <label class="break-inside-avoid flex items-center space-x-2">
                        <input type="checkbox" class="outline outline-white form-checkbox h-5 w-5 text-blue-600" [checked]="statsService.getColumnIsVisible('MedianLuck', idx + 1)" (change)="onColumnFilterChange($event, idx + 1)">
                        <span class="break-all whitespace-nowrap">Week {{idx + 1}}</span>
                    </label>
                }
            </div>
        </div>
    </div>
}